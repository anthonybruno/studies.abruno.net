---
import Layout from '@/layouts/Layout.astro';
import DynamicText from '@/components/DynamicText.astro';
import ProjectList from '@/components/ProjectList.astro';
import { getCollection, render } from 'astro:content';
import { Picture } from 'astro:assets';

export async function getStaticPaths() {
  const caseStudiesPaths = await getCollection('caseStudies');
  return caseStudiesPaths.map((post) => ({
    params: { slug: post.data.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<Layout back={true}>
  <div class="w-full pb-8">
    {
      post.data.primaryImage && (
        <Picture
          class="w-full dark:opacity-30 dark:duration-[4000ms] dark:hover:opacity-100"
          src={post.data.primaryImage}
          formats={['avif', 'webp', 'jpeg']}
          alt={post.data.title}
        />
      )
    }
  </div>
  <div class="space-y-14">
    <h1 class="text-3xl">{post.data.title}</h1>
    <div class="items-start max-sm:space-y-14 sm:flex sm:space-x-14">
      {
        post.data.meta.map((group) => (
          <div class="lg:w-1/2">
            <span class="font-semibold">{group.label}</span>
            <ul class="text-tony-500">
              {group.items.map((item: string) => (
                <li>
                  <span>{item}</span>
                </li>
              ))}
            </ul>
          </div>
        ))
      }
    </div>
    <DynamicText>
      <Content />
    </DynamicText>
    <div>
      {
        post.data.links && (
          <ul class="space-y-4">
            {post.data.links.map((link) => (
              <li>
                <a
                  class="group text-theme hover:text-theme-hover font-medium"
                  href={link.url}
                  target={link.new_window ? '_blank' : '_self'}
                >
                  <span>{link.title}</span>
                  {link.new_window ? <span>↗</span> : <span>→</span>}
                </a>
              </li>
            ))}
          </ul>
        )
      }
    </div>
  </div>
  <div class="pt-36">
    <ProjectList
      title="Case Studies"
      className="text-pretty"
      hideActive={true}
      currentSlug={post.data.slug}
    />
  </div>
</Layout>
